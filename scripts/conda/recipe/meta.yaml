{% set pyproject = load_file_data('../../../pyproject.toml', from_recipe_dir=True) %}
{% set buildsystem = pyproject['build-system'] %}
{% set project = pyproject['project'] %}

{% set name = project['name'] %}
{% set version = VERSION %}

package:
  name: {{ name|lower }}
  version: {{ version }}

source:
  url: ../../../dist/{{ name }}-{{ version }}.tar.gz

build:
  noarch: python
  script: {{ PYTHON }} -m pip install --no-deps -vv .

requirements:
  build:
    - python {{ project['requires-python'] }}
    - pip
    {% for dep in buildsystem['requires'] %}
    - {{ dep }}
    {% endfor %}

  run:
    - python {{ project['requires-python'] }}

test:
  requires:
    {% for dep in project['optional-dependencies']['tests'] %}
    - {{ dep }}
    {% endfor %}
  source_files:
    - pyproject.toml
    - tests
  imports:
    - param
    - numbergen
  commands:
    - python -c "import param; ver = param.__version__; assert ver != '0.0.0' and ver != 'unknown'"
    - pytest tests

about:
  home: {{ project['urls']['Homepage'] }}
  summary: {{ project['description'] }}
  license: {{ project['license']['text'] }}
  license_file: LICENSE.txt
  description: |
    Param is a zero-dependency library for declaring rich
    attributes - Parameters - with extended metadata used for
    various purposes such as runtime type and range validation,
    default values or factories, nullability, docstrings, etc.
    It also supplies a suite of reactive APIs (watch, depends,
    bind, and reactive expressions), enabling automatic updates
    on attribute changes and declaring complex reactive
    dependencies and expressions that can be introspected by other
    frameworks to implement their own reactive workflows.
    These capabilities power HoloViz projects like Panel and HoloViews,
    making Param a solid foundation for building validated,
    introspectable, and responsive libraries and applications.
